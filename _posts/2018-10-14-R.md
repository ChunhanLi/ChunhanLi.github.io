---
layout:     post
title:      R
subtitle:   R
date:       2018-10-14
author:     Chunhan Li
header-img: img/post-bg-re-vs-ng2.jpg
catalog: false
tags:
    - R
---
[toc]

## 前言
这个文档用于记录学习中遇到的一些R的函数，还有一些好用的用法~（经常偶尔遇到一些特别好用的函数，过几天就忘记怎么用了）。主要用于自己的学习，所以简单的函数就稍微注释一下，不仔细写具体作用了。

## 正文
### directory

```
setwd('~')#to home directory
list.file('/')# top level of pc
setwd('..')

```

### Load data

```
str()
summary()
sapply(data, class)

```
### ggplot2

```
ggplot(data, aes(x = , y = , color = , )) + geom_point() +
geom_text(aes(label = ...), vjust = 'top', hjust = 'left')##字颜色也会变

geom_point(aes(color = group))##只有点颜色变

geom_text(aes(label = .., color = group ))##文字颜色

ggplot(dogs,aes(x = datadog, y =popularity, color = 'blue')) + geom_point() +
  geom_text(aes(label = breed), vjust='top', hjust = 'left')  +
  scale_y_reverse() # 错误的写法 在aes里面blue会被看成一个属性

theme_classic()##change style this one seems like  normal plot style

xlab, ylab, ggtitle

theme(plot.title = element_text(hjust = 0.5))#标题居中

theme(legend.position="none")##去掉legend

theme(axis.text.x=element_text(face="bold",size=5,angle=90,color="red"))##x刻度调整
scale_x_discrete(breaks = c('FALSE', 'TRUE'), labels = c('suburbs', 'cities'))##x轴刻度换名字
scale_color_discrete(labels = c())   ###color 换名字
guides(colour = guide_legend(override.aes = list(size= 2)))##改legend图例大小
###legend grouped by color 可以不显示NA类
scale_color_discrete(na.translate = FALSE)

scale_x_discrete(limits = c('ctrl', 'trt2', 'trt1')) #不改名字 换位置
 scale_x_discrete(limits = rev(levels(PlantGrowth$group)))##反转x刻度

guides(color = guide_legend(title = ''))#修改Legend标题 color 是 group的根据
guides(fill=guide_legend(title="1")) #修改legend 标题

scale_y_reverse()# reverse y-axis
ggplot(data, aes(x = , y = -a))# the same with reverse

ylim(c(0,3))#may cut off data
coord_cartesian(ylim = c(0,3))# always keep all lines/points

## 上面例子 具体的说 比如做一个regression fit ylim会去掉范围之外的点做 而coord的不会 他只是局部放大

##coord系列 调整xy比例 xy做变换 xy flip参考 https://www.cnblogs.com/wkslearner/p/5718928.html
coord_fixed(ratio = 1)

geom_point(stat = 'count') geom_bar ##也有这个参数

geom_histogram(bin = 100)
geom_density(bw = 0.1)

geom_vline(aes(xintercept = mu), color = 'red')## ad a verical line
geom_hline(aes(yintercept = m))## add a horizontal line
geom_abline(linetype="dashed") ## add any straight line

library(ggridges)
geom_density_ridges() ##画密度 y 分开那种 和facet有点像

facet_grid(y~x) ## y x 上都有
facet_wrap(~ y + x)

library(ggrepel)
ggplot(dogs, aes(datadog, popularity)) + geom_point() +
  geom_text_repel(aes(label = breed)) ##自动使text不重叠

## ggplot 后面加上的图层 在最上面

##图形组合

library(gridExtra)
grid.arrange(g1, g2,g3,ncol= 2, nrow = 2, widths = c(2,1), heights = c(2,1)
top = ,bottom = ##图旁边的字)

grid.arrange(
  g1,g2,g3,
  widths = c(1, 1),
  layout_matrix = rbind(c(1, 1),
                        c(2, 3)),##可用matrix
  top = 'G', bottom = 'D', left = 'FF'
  )

### ggplot 画proportion问题

## 1 A变量 有 3类 想画每一类的prop of count

ggplot(data, aes( x = A, y = stat(prop), group = factor(1))) + geom_bar() + scale_y_continuous(labels = scales::percent)###不加group画不出来

## 2 A变量 三类 B变量两类 画B在每种A中的比例 position = 'fill'

ggplot(data, aes(x=A,fill=B)) + geom_bar(position = 'fill') +  scale_y_continuous(labels = scales::percent)

```

- ggmap

```
## get_stamenmap

bbox = c(
-121.790225, 38.518210, # bottom left
-121.695120, 38.571458 # top right
)
m = get_stamenmap(bbox, zoom = 15) # default zoom = 10
ggmap(m)

### bounding box http://boundingbox.klokantech.com/

m = get_stamenmap(bbox, zoom = 3, maptype = "toner-lite")
ggmap(m)

### 和ggmap连用

ggmap(m) + geom_point(aes(Longitude, Latitude), ap)

##get_googlemap
location = rev(c(38.499850, -98.362930))
map = get_googlemap(center = location, zoom = 3)
ggmap(map)

### library(sf) ##shapefiles


```


### 其他
- typeof(), class()

- library(pryr) object.size()查看内存

- table(.., useNA = 'always')

```
tb = table(a = data$a, b = data$b)##groupby
addmargins(tb, margin = 1 /2)##不设margin参数 就都求sum
tb_p = prop.table(tbl, margin = )##求每个的频率
as.data.frame(tb_p)##会出现Freq列

ggplot(dogs, aes(x= lifetime_cost, y= Freq)) + geom_bar(stat = 'identity')
```

- split

```
split(data,data$year)##返回list
```

- startswith [str 处理]
- aggregate 有点像bygroup

```
aggregate(tuition.in_state~ownership,college,mean, na.rm = T)
```
- factor/levels

```
###original level ('large', 'medium', 'small') 改名
levels(dog$size) = c('huge', 'medium', ' small')##要一一对应

levels(dogs$size) = c('small', 'medium', 'large')##wrong way

## the way to reorder
size_six = factor(dogs$size, levels = c('small', 'medium', 'large'))

```

- cut family

```
cut_number(data, 5)##分成五组等数量的
cut_interval(data, 5)##分成五组等距离的
cut_width(data, 5000)##每个组距5000
```

- apply/sapply/tapply

```
sapply(dataframe, mean)

tapply(data$a, data$b, mean)##t 代表table 用法类似于table

```

- match(x, table) 返回table里的index

```
a = match(b, data$A)##可以用作 如果想将b中的几类一一对应成其他的东西 可以在
data$B[a]                    ## data中设置B 然后data$B[a]
```

- merge 上面描述的问题也可以使用

```
merge(air, data, by.x = 'sss', by.y = 'A', all.x = T/F , all.y)

##两列名一样 直接用by all.x/y控制左联结右联结
```

- reorder

```
## ggplot的横坐标 category根据levels排序
1.
m$OP_UNIQUE_CARRIER = factor(m$OP_UNIQUE_CARRIER, levels = )##levels手动排序
2.
m$OP_UNIQUE_CARRIER = reorder(m$OP_UNIQUE_CARRIER, m$prop) 会根据后面的参数大小排序
```

- do.call(fcn, obj)

```
##处理dataframe和list 暂时没感受到处理dataframe的优势 ， 就先举了list的例子
bb 		<- 	list(matrix(1:25, ncol = 5), matrix(4:28, ncol = 5), matrix(21:45, ncol=5))
bb
bb_sum 	<- 	do.call(sum,bb)
bb_sum
bb_bind <-	do.call(cbind,bb)
bb_bind
```
- Rmarkdown dataframe -> table

```
#https://rmarkdown.rstudio.com/lesson-7.html
```

- rev(c(2,3,4)) ->c(4,3,2)

- setdiff

```
a=c('a','b','c')
b=c('a','b')
setdiff(a,b)
```

- library(stringr)

```
davis1 = 'Davis city, California'
davis2 = 'Davis CDP, California'
str_remove(davis1, 'city, California')
str_remove(c(davis1,davis2), '(city|CDP), California')


###str_remove remove first one
### str_remove_all remove all
str_remove_all(x, fixed('cats', ignore_case = TRUE))
str_detect('Cats','.')##.匹配任一字符
str_detect('','.')-》False###无法匹配''

###[A-z] all letter
###[a-z] lowercase
###[A-Z] UPPERCASE
### 转义符号 \\
```

- library(plyr)

```
library(plyr)
player_city<-join(citypop,PlayerCounts,type="left",by="City") #This is a LEFT join

```

- subset

```
sac_apt<-subset(apt,place=="Sacramento")
```

- droplevels

```
a = c('a','a','b','c')
a = factor(a)
a = a[-3]
a
droplevels(a)
```
